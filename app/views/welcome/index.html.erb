<div id="dashboard-container" class="">
 	<div class="form-group col-xs-12 form-group text-center">
 		<h2>Welcome back to the kitchen, <%=current_dietitian.email %>!</h2>
 	</div>
 	<div id="dash-main" class="row">
		<div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
			<h3>Upcoming Sessions</h3>
			<div class="col-xs-6">
				<%=link_to "Set your availability", availabilities_path %>
			</div>
			<div class="col-xs-6">
				<p>Full Schedule</p>
			</div>
			<div id="appointment-update-container">
				<% @upcoming_appointments.each do |date_time_array, appointment| %>
					<div class="row dashbord-list-top">
						<div class="col-xs-12 text-left">
								<p><%=date_time_array[0].in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y")%></p>
						</div>
					</div>
					<div class="row">
						<div class="col-xs-3">
							<p><%=date_time_array[1]%></p>
						</div>
						<div class="col-xs-6">
							<p><%=appointment.first.family_info.family_names%></p>
						</div>
						<div class="col-xs-3">
							<button data-appt-id="<%=appointment.first.id%>" class="btn btn-sm btn-success prep-appointment-button">Prep</button>
						</div>
					</div>
					<div class="row hidden-xs dashboard-list-bottom">
						<div class="col-xs-3">
						</div>
						<div class="col-xs-9">
							<% appointment.first.family_info.health_groups_names.each do |health_group|%>
					 			<div class="btn btn-white-orange btn-sm">
					 				<%=	health_group %>
					 			</div>
							<% end %>
						</div>
					</div>
				<% end %>
			</div>
		</div>
		<div class="col-xs-12 col-sm-4 col-md-4 col-lg-4 text-center">
			<% if @next_appointment != nil %>
				<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-center">
					<p><%= link_to image_tag("computer.png", class: "tilt"), "http://www.kindrdcare.com/sign_in" %></p>
					<p><%=@next_appointment.start_time.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y %I:%M %p")%></p>
					<p><%=@next_appointment.family_info.family_names%></p>
					<button data-appt-id="<%=@next_appointment.id%>" class="btn btn-sm btn-success prep-appointment-button">Prep</button>
					<%= link_to 'Join Session', {:controller => "rooms", :action => "in_session", :id => @next_appointment.room_id, appointment: @next_appointment.id }, class: "text-center action kindrd-button btn-block tilt"%>
				</div>
			<% else %>
				<div class="col-xs-12">
					<p><%= link_to image_tag("chef-hat.png", class: "tilt"), :controller => "recipes", :action => "new" %>	</p>
					<p>Create a Recipe</p>
				</div>
			<% end %>
		</div>
		<div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
			<h3>Review Recipes</h3>
			<div class="col-xs-6 text-left">
				<p>Goal: 10</p>
			</div>
			<div class="col-xs-6 text-right">
				<p>Completed: 5/10</p>
			</div>
			<div id="appointment-update-container">
				<% @incomplete_quality_reviews.each do |quality_review| %>
					<div class="row dashbord-list-top">
						<div class="col-xs-9 text-left">
								<p><%=quality_review.recipe_name%></p>
						</div>
						<div class="col-xs-3">
							<%=link_to "Review", quality_reviews_start_review_path(quality_review.quality_reviewable, quality_review), class: "btn btn-sm btn-success" %>
						</div>
					</div>
					<div class="row dashboard-list-bottom">
						<div class="col-xs-12">
							<p><%=quality_review.number_of_ingredients%> ingredients</p>
						</div>
						<div class="col-xs-3">
						</div>
						<div class="col-xs-9">
						<% quality_review.health_groups_names.each do |health_group|%>
				 			<div class="btn btn-white-orange btn-sm">
				 				<%=	health_group %>
				 			</div>
						<% end %>
						</div>
					</div>
				<% end %>
			</div>
		</div>
	</div>
</div>

			<%# if appointment.first.room_id %>
			<%# if (((DateTime.now.in_time_zone("Eastern Time (US & Canada)") - @appointment.first.start_time) / 60 / 60) > -5)%>
				<%#= link_to 'Join Session', {:controller => "rooms", :action => "in_session", :id => appointment.first.room_id, appointment: appointment.first.id }, class: "text-center action kindrd-button btn-block tilt"%>
			<%# else %>
			<%# end %>

<script type="text/javascript">
	$(".prep-appointment-button").on("click", function(e){
		e.preventDefault();
		var appointment_id = $(this).data("appt-id");

			$.ajax({
				type: "GET",
				datatype: "script",
				data: {},
				url: "/appointments/"+appointment_id+"/appointment_prep/",
				success: function(response){
         	var active_id = $(".selected-family-member").data("id");
         	debugger;
         	$(".family-member-health-preview").on("click", function(e){
         		e.preventDefault();
         		var family_member_id = $(this).data("family-member-id");
         		debugger;
         		$(".family-member-health-container").addClass("hidden");
         		$(".family-member").removeClass("selected-family-member");
         		$("#family-member-"+family_member_id).addClass("selected-family-member");         		
         		$("#family-member-health-"+family_member_id).removeClass("hidden");

         	});
			  	$("#family-member-food-button").on("click", function(e){
			  		e.preventDefault();
						$.ajax({
			         type: "GET",
			         datatype: "script",
			         data: {survey_type: "User-Food", id: active_id},
			         url: "/users/"+active_id+"/surveys/new",
			         success: function(response){
			         	$(".active-tab").removeClass("active-tab");
			         	$("#family-member-food-button").parent().addClass("active-tab");
			         } 
			     	})
			  	});
			  	$("#family-member-life-button").on("click", function(e){
			  		e.preventDefault();
						$.ajax({
			         type: "GET",
			         datatype: "script",
			         data: {survey_type: "User-Life", id: active_id},
			         url: "/users/"+active_id+"/surveys/new",
			         success: function(response){
			         	$(".active-tab").removeClass("active-tab");
			         	$("#family-member-life-button").parent().addClass("active-tab");
			         } 
			     	})
			  	})
         } 
     	})
  	// });
  	// $("#family-member-life-button").on("click", function(e){
  	// 	e.preventDefault();
			// $.ajax({
   //       type: "GET",
   //       datatype: "script",
   //       data: {survey_type: "User-Life", id: active_id},
   //       url: "/users/"+active_id+"/surveys/new",
   //       success: function(response){
   //       	$(".active-tab").removeClass("active-tab");
   //       	$("#family-member-life-button").parent().addClass("active-tab");
   //       } 
   //   	})
  	// })
	})
</script>