<div class="row">
  <div class="col-xs-12">
    <h1>Kindrdfood Content <%= link_to "Create new content", new_admin_post_path, class: "btn btn-lg" %></h1>
  </div>
  <section class="col-xs-12">
    <p>Toggle column: </p>
    <p class="hide-general-columns">
    </p>
    <p class="hide-tag-columns">
      <a class="hide-all-tags hidden">Hide All Tags - </a> 
      <a class="show-all-tags">Show All Tags - </a> 

    </p>
    <!--     in line style width:100% necessary for datatable plugin -->
    <table class="table table-striped table-bordered table-hover table-condensed datatable" style="width:100%">
      <thead>
        <tr>
          <th><%= t(".title")%></th>
          <th><%= t(".url")%></th>
          <th><%= t(".type")%></th>
          <th><%= t(".author")%></th>
          <th>Created At</th>
          <th>Target Publish Date</th>
          <th>Date Published</th>
          <th>Published</th>
          <th>Shared</th>
          <th></th>
          <th></th>
          <%@tags.each do |tag| %>
            <th><%=tag.name%></th>
          <% end %>
        </tr>
      </thead>
      <tfoot>
        <tr>
          <th><%= t(".title")%></th>
          <th><%= t(".url")%></th>
          <th><%= t(".type")%></th>
          <th><%= t(".author")%></th>
          <th>Created At</th>
          <th>Target Publish Date</th>
          <th>Date Published</th>
          <th>Published?</th>
          <th>Shared?</th>
          <th></th>
          <th></th>
          <%@tags.each do |tag| %>
            <th><%=tag.name%></th>
          <% end %>
        </tr>
      </tfoot>
      <tbody>
        <% @posts.each do |post|%>
          <tr> 
            <td><%= post.title %></td>
            <td><%= link_to "/#{post.url}", post.full_url, target: "_blank" %></td>
            <td><%= post.content_type %></td>
            <td><span><%= post.user.email %></span> </td>
            <td><%= post.user.created_at %> </td>
            <td><%= post.target_published_at %> </td>
            <td><%= post.published_at %> </td>
            <td><%= post.published %> </td>
            <td><%= post.public %> </td>
            <td><%= link_to t(".edit"), edit_admin_post_path(post), class: "btn btn-small" %></td>
            <td><%= link_to t(".delete"), [:admin, post],data: {confirm: 'Are you sure?'}, method: :delete, class: "btn btn-small btn-danger" %></td>
            <%@tags.each do |tag| %>
              <th><%=post.tags.include?(tag)%></th>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </section>

</div>







<script type="text/javascript">
  $(document).ready(function() {

    // Create table
    var table = $(".datatable").DataTable({

        // select filter on footer
       initComplete: function () {
            this.api().columns().every( function () {
                var column = this;
                var select = $('<select><option value=""></option></select>')
                    .appendTo( $(column.footer()).empty() )
                    .on( 'change', function () {
                        var val = $.fn.dataTable.util.escapeRegex(
                            $(this).val()
                        );
 
                        column
                            .search( val ? '^'+val+'$' : '', true, false )
                            .draw();
                    } );
 
                column.data().unique().sort().each( function ( d, j ) {
                    select.append( '<option value="'+d+'">'+d+'</option>' )
                } );
            } );
        }
    });

    // Set num of columns
    var numColumns = table.columns()[0].length;
    var hideColumnLink, columnTitle;

    // Create Links to hide columns
    for (var i = 0, l = numColumns; i < l; i++ ) {

      columnTitle = $(table.columns( i ).header()).text();

      hideColumnLink = i === l - 1 || i === 9 ? '<a class="toggle-vis" data-column="'+i+'">'+columnTitle+'</a>' : '<a class="toggle-vis" data-column="'+i+'">'+columnTitle+'</a> - ';


      // append and hide tag columns to start
      if ( i > 10) {
        if (columnTitle !== "") {
          $('.hide-tag-columns').append(hideColumnLink);
        }
        table.column(i).visible(false);
      } else {
        if (columnTitle !== "") {
          $('.hide-general-columns').append(hideColumnLink);
        }
        $("a[data-column='" + i + "']").addClass("visible-column");
      }
    };

    // Create link to show all tag columns
    $(".show-all-tags").on("click", function(e){
      e.preventDefault();
      for (var i = 11, l = numColumns; i < l; i++ ) {
        table.column(i).visible(true);  
        $("a[data-column='" + i + "']").addClass("visible-column");
      }
      $(".show-all-tags, .hide-all-tags").toggleClass("hidden");

    })

    // Create link to hide all tag columns
    $(".hide-all-tags").on("click", function(e){
      e.preventDefault();
      for (var i = 11, l = numColumns; i < l; i++ ) {
        table.column(i).visible(false);  
        $("a[data-column='" + i + "']").removeClass("visible-column");
      }
      $(".hide-all-tags, .show-all-tags").toggleClass("hidden");  
    })

    // When links are clicked then toggle column
    $('a.toggle-vis').on( 'click', function (e) {
        e.preventDefault();
 
        // Get the column API object
        var column = table.column( $(this).attr('data-column') );
 
        // Toggle the visibility
        column.visible( ! column.visible() );

        // Toggle link color
        $(this).toggleClass("visible-column");
    } );

  })
</script>






<% if @page %>
  <%= render partial: "pagination" %>
<% end %>