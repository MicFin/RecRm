
<div class="modal fade" id="paymentModal" tabindex="-1" role="dialog" aria-labelledby="paymentModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="paymentModalLabel"><%=image_tag "/assets/nav_images/logo.png", class: "img-responsive" %></h4>
      </div>
      
      <div class="modal-body">
        <div class="row form-group">
          <div class="col-xs-12 text-center">
            <h2><%=@time_slot.start_time.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y") %>
            </h2>
            <h2><%=@time_slot.start_time.in_time_zone("Eastern Time (US & Canada)").strftime("%l:%M") %> - <%=@time_slot.end_time.in_time_zone("Eastern Time (US & Canada)").strftime("%l:%M %p") %>
            </h2> 
          </div>

          <!--           DISCOUNT CODE -->
          <% if (@user.qol_referral == false) && (@purchasable.status != "Unused Package Session")%>


            <div class="col-xs-8 col-xs-offset-2 text-center">
              <% if @purchase.invoice_cost != @purchase.invoice_price %>
             

                <div class="col-xs-12 form-group">
                  <h1><%=@purchasable.show_duration%>: <del class="regular-price"><%=@purchase.show_invoice_cost%></del> <span class="invoice-price"><%= @purchase.show_invoice_price%></span></h1>
                  <h2 id="coupon-description"><%=@purchase.coupon_redemption.coupon.description if @purchase.coupon_redemption%></h2>
                </div>
                <div class="col-xs-12 form-group">
                  <div class="col-xs-8">
                    <input type="text" class="form-control hidden" id="coupon-field" placeholder="Enter discount code" name="coupon">
                  </div>
                  <div class="col-xs-2">
                    <button id="coupon-button" class="btn btn-sm btn-link hidden">APPLY DISCOUNT</button>
                    <button id="remove-coupon-button" class="btn btn-link">remove discount</button>
                  </div>
                </div>

              <% else %>
            

                <div class="col-xs-12 form-group">
                  <h1><%=@purchasable.show_duration%>: <span class="invoice-price"><%= @purchase.show_invoice_price%></span></h1>
                  <h2 id='coupon-description'></h2>
                </div>
                <div class="cl-xs-12 form-group">
                  <div class="col-xs-8">
                    <input type="text" class="form-control" id="coupon-field" placeholder="Enter discount code" name="coupon">
                  </div>
                  <div class="col-xs-2">
                    <button id="coupon-button" class="btn btn-sm btn-link">APPLY DISCOUNT</button>
                    <button id="remove-coupon-button" class="btn btn-link hidden">remove discount</button>
                  </div>
                </div>


              <% end %>
            </div>
          <% end %>
        </div>
        <div class="row form-group">
          <div class="col-xs-8 col-xs-offset-2 discount-response">
          </div>
        </div>
        <%= simple_form_for @purchase, 
          :url => make_payment_path(@purchasable, @purchase),
          :method => 'post' do |f| %>
    
          <% if @purchase.errors.any? %>
            <div id="error_explanation">
              <h2><%= pluralize(@purchase.errors.count, "error") %> prohibited this appointment from being saved:</h2>

              <ul>
              <% @purchase.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
              </ul>
            </div>
          <% end %>

          <% if @purchase.stripe_card_token %>
            Session has already been paid for.
          <% elsif @purchasable.status == "Unused Package Session" %>
            <div class="row">
              <div class="col-xs-10 col-xs-offset-1">
                <h3>Using <%=@purchasable.duration%> minute session credit from current package.</h3>
              </div>
            </div>
            <%= f.hidden_field :stripe_card_token, value: "example" %>
            
          <% elsif @user.qol_referral == false %>

            <div class="row">
              <div class="col-xs-10 col-xs-offset-1">
                <div class="col-xs-12"> 
                  <%= label_tag :card_number, "Credit Card Number" %>
                    <%=image_tag "/assets/icons/mastercard.png", class: "hidden-xs credit-card-images" %>
                    <%=image_tag "/assets/icons/visa.png", class: "hidden-xs credit-card-images" %> 
                    <%=image_tag "/assets/icons/amex.png", class: "hidden-xs credit-card-images" %>  
                    <%=image_tag "/assets/icons/discover.png", class: "hidden-xs credit-card-images" %>   

                </div>
                <div class="col-xs-12 form-group">
                  <div class="col-xs-12 col-sm-10 col-md-10 col-lg-10">
                  <%= text_field_tag :card_number, nil, name: nil, :placeholder => "1234  5678  9876  5432", :class => "form-control" %>
                  </div>
                </div>
                <div class="col-xs-12">
                  <%= label_tag :card_code, "Security Code on Card (CVV)" %>
                </div>
                <div class="col-xs-12 form-group">
                  <div class="col-xs-4">
                    <%= text_field_tag :card_code, nil, :placeholder=>"123", name: nil, :class => "form-control" %>
                  </div>
                </div>
                <div class="col-xs-12">
                  <%= label_tag :card_month, "Card Expiration" %>
                </div>
                <div class="col-xs-12 form-group">
                  <div class="col-xs-6 col-sm-4 col-md-4 col-lg-4">
                    <%= select_month nil, {add_month_numbers_true: true}, {name: nil, id: "card_month", class: "form-control"}%>
                  </div>
                  <div class="col-xs-5 col-sm-4 col-md-4 col-lg-4 col-xs-offset-1">
                    <%= select_year nil, {start_year: Date.today.year, end_year: Date.today.year+15}, {name: nil, id: "card_year", class: "form-control"} %>
                  </div>
                </div>
                <div class="col-xs-10 col-xs-offset-1 form-group checkbox">
                  <label>
                    <input name="credit_card_usage" value="remember_me" type="checkbox"> Remember my information for future appointments
                  </label>
                </div> 
              </div>
                <%= f.hidden_field :stripe_card_token %>
            </div>

          <% else %>
              <%= f.hidden_field :stripe_card_token, value: "example" %>
          <% end %>
          <div id="stripe_error">
            <noscript>JavaScript is not enabled and is required for this form. First enable it in your web browser settings.</noscript>
          </div>
          <div class="actions">
            <input type="hidden" name="time_slot_id" id: "time-slot-id" value="<%=@time_slot.id%>">
            <%= f.button :submit, "Submit", class: "btn btn-success btn-block", id: "btn-purchase-appt" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>