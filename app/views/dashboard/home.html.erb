<div id="user-home-page" class="container">
	<div class="form-group col-xs-12 form-group text-center">
 		<h2>Welcome to Kindrdfood, <%=current_user.first_name %>!</h2>
 	</div>
	<div id="appointment-update-container" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 text-left alert alert-success">
		<h3>Upcoming Appoinment: <span><%=@appointment.start_time.in_time_zone("Eastern Time (US & Canada)").strftime("%B %d, %Y %I:%M %p")%></span></h3>
	</div>
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
    <div class="col-xs-3">
  		<p><%= image_tag("computer.png") %></p>
    </div>
    <div class="col-xs-9">
      <% if @survey %>
        <%= render "/surveys/form" %>
      <% else %>
        <div id="upcoming-appointment-container" data-appointment-id="<%=@appointment.id%>">
          <p>Please complete these steps prior to your appointment:</p>
          <ol>
            <li class="completed-list-item">Complete appointment questionnaire basics</li>
            <% if @appointment.status != "Appt-Prep-Survey-Complete" %>
              <li id="complete-list-questionnaire">Complete <button class="btn btn-lg btn-success" id="edit-family-button">Health & Food</button> questionnaire</li>
            <% else %>
              <li id="complete-list-questionnaire" class="completed-list-item">Complete <button class="btn btn-lg btn-success" id="edit-family-button">Health & Food</button> questionnaire</li>
            <% end %>
            <li>Start your appointment</li>
          </ol>

          <% if @appointment.room_id %>
          <%# if (((DateTime.now.in_time_zone("Eastern Time (US & Canada)") - @appointment.start_time) / 60 / 60) > -5)%>
            <%= link_to 'Join Session', {:controller => "rooms", :action => "in_session", :id => @appointment.room_id, appointment: @appointment.id }, class: "text-center action kindrd-button btn-block tilt"%>
          <% else %>
            <h5>Return 15 minutes before appointment to sign in</h5>
          <% end %>
        </div>
      <% end %>
    </div>
	</div>
	<div class="col-xs-5">
	<%#=link_to "Upgrade to Premium", new_subscription_path, remote: true%>
	</div>

</div>
	<%= render "/families/edit_modal" %>



<script type="text/javascript">
	$("#edit-family-button").on("click", function(e){
		e.preventDefault();
		$("#familyModal").modal({
            backdrop: 'static',
            keyboard: false
    });
    $("#complete-pre-appt-survey-button").on("click", function(e){
      e.preventDefault();  
      var appointment_id = $("#upcoming-appointment-container").data("appointment-id");
      var url = "/appointments/"+appointment_id+"/complete_appt_prep_survey"
      debugger;
      $.ajax({
         type: "GET",
         datatype: "script",
         data: {id: appointment_id},
         url: url,
         success: function(response){  
           $(".active-tab").removeClass("active-tab");
           $("#family-member-health-button").parent().addClass("active-tab");
         } 
      })    
    })
    $("#family-member-health-button").on("click", function(e){
      e.preventDefault();
      var active_id = $(".selected-family-member").data("family-member-id");
      $.ajax({
         type: "GET",
         datatype: "script",
         data: {id: active_id},
         url: "/registrations/edit_user_health_groups/"+active_id,
         success: function(response){  
           $(".active-tab").removeClass("active-tab");
           $("#family-member-health-button").parent().addClass("active-tab");
         } 
      })
    });
  	$("#family-member-food-button").on("click", function(e){
  		e.preventDefault();
      var active_id = $(".selected-family-member").data("family-member-id");
			$.ajax({
         type: "GET",
         datatype: "script",
         data: {survey_type: "User-Food", id: active_id},
         url: "/users/"+active_id+"/surveys/new",
         success: function(response){  
         	 $(".active-tab").removeClass("active-tab");
         	 $("#family-member-food-button").parent().addClass("active-tab");
         } 
     	})
  	});
  	$("#family-member-life-button").on("click", function(e){
  		e.preventDefault();
      var active_id = $(".selected-family-member").data("family-member-id");
			$.ajax({
         type: "GET",
         datatype: "script",
         data: {survey_type: "User-Life", id: active_id},
         url: "/users/"+active_id+"/surveys/new",
         success: function(response){
         	 $(".active-tab").removeClass("active-tab");
         	 $("#family-member-life-button").parent().addClass("active-tab");
         } 
     	})
  	})
	})
</script>





