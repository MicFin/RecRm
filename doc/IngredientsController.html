<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: IngredientsController
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!IngredientsController.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (I)</a> &raquo;
    
    
    <span class="title">IngredientsController</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: IngredientsController
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">ActionController::Base</li>
          
            <li class="next"><span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></li>
          
            <li class="next">IngredientsController</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">app/controllers/ingredients_controller.rb</dd>
  
</dl>
<div class="clear"></div>








  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit-instance_method" title="#edit (instance method)">- (Object) <strong>edit</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>GET /ingredients/1/edit.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#edit_allergens-instance_method" title="#edit_allergens (instance method)">- (Object) <strong>edit_allergens</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>respond_to do |format|     if @ingredient.save       format.html {
redirect_to @ingredient, notice: &#39;Ingredient was successfully
created.&#39; }       format.json { render :show, status: :created,
location: @ingredient }     else       format.html { render :new }      
format.json { render json: @ingredient.errors, status:
:unprocessable_entity }     end   end end.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#index-instance_method" title="#index (instance method)">- (Object) <strong>index</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p># GET /ingredients # GET /ingredients.json.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update-instance_method" title="#update (instance method)">- (Object) <strong>update</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>PATCH/PUT /ingredients/1 PATCH/PUT /ingredients/1.json.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#update_allergens-instance_method" title="#update_allergens (instance method)">- (Object) <strong>update_allergens</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods inherited from <span class='object_link'><a href="ApplicationController.html" title="ApplicationController (class)">ApplicationController</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="ApplicationController.html#after_sign_in_path_for-instance_method" title="ApplicationController#after_sign_in_path_for (method)">#after_sign_in_path_for</a></span></p>

  
  

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="edit-instance_method">
  
    - (<tt>Object</tt>) <strong>edit</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>GET /ingredients/1/edit</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27
28
29
30</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/ingredients_controller.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edit'>edit</span>
  <span class='ivar'>@allergens</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_top_allergens'>top_allergens</span>
  <span class='ivar'>@suggested_allergens</span> <span class='op'>=</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_suggested_allergens'>suggested_allergens</span>
  <span class='ivar'>@recipe</span> <span class='op'>=</span> <span class='const'>Recipe</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:recipe_id</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='ivar'>@other_allergens</span> <span class='op'>=</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_other_allergens'>other_allergens</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="edit_allergens-instance_method">
  
    - (<tt>Object</tt>) <strong>edit_allergens</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>respond_to do |format|</p>

<pre class="code ruby"><code class="ruby">  if @ingredient.save
    format.html { redirect_to @ingredient, notice: &#39;Ingredient was successfully created.&#39; }
    format.json { render :show, status: :created, location: @ingredient }
  else
    format.html { render :new }
    format.json { render json: @ingredient.errors, status: :unprocessable_entity }
  end
end</code></pre>

<p>end</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/ingredients_controller.rb', line 48</span>

<span class='kw'>def</span> <span class='id identifier rubyid_edit_allergens'>edit_allergens</span>
  <span class='comment'>## when coming from js the recipe id is params[&quot;recipe_id&quot;]
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>recipe_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='ivar'>@recipe_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>recipe_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>else</span>
    <span class='ivar'>@recipe_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='symbol'>:id</span><span class='rbracket'>]</span>
  <span class='kw'>end</span>
  <span class='ivar'>@recipe</span> <span class='op'>=</span> <span class='const'>Recipe</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@recipe_id</span><span class='rparen'>)</span>
  <span class='comment'># recipe ingredients that are already tagged with allergens
</span>  <span class='ivar'>@ingredients_tagged</span> <span class='op'>=</span> <span class='ivar'>@recipe</span><span class='period'>.</span><span class='id identifier rubyid_ingredients_tagged'>ingredients_tagged</span>
  <span class='comment'># recipe ingredients that are not tagged with allergens yet
</span>  <span class='ivar'>@ingredients_not_tagged</span> <span class='op'>=</span> <span class='ivar'>@recipe</span><span class='period'>.</span><span class='id identifier rubyid_ingredients_not_tagged'>ingredients_not_tagged</span>
  <span class='ivar'>@top_allergens</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_top_allergens'>top_allergens</span><span class='period'>.</span><span class='id identifier rubyid_order'>order</span><span class='lparen'>(</span><span class='symbol'>:name</span><span class='rparen'>)</span>
  <span class='ivar'>@all_allergens</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_common_allergens'>common_allergens</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:name</span><span class='rparen'>)</span>
   <span class='comment'># if there are other ingredients tha tneed to be tagged
</span>  <span class='kw'>if</span> <span class='ivar'>@recipe</span><span class='period'>.</span><span class='id identifier rubyid_ingredients_not_tagged'>ingredients_not_tagged</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;=</span> <span class='int'>1</span>
    <span class='comment'># make ingredient variable the next to be tagge
</span>    <span class='ivar'>@ingredient</span> <span class='op'>=</span> <span class='ivar'>@recipe</span><span class='period'>.</span><span class='id identifier rubyid_ingredients_not_tagged'>ingredients_not_tagged</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='comment'># # set tagging_done to false
</span>    <span class='comment'># @tagging_done = false
</span>    <span class='comment'># if there are suggested allerens then grab them
</span>    <span class='kw'>if</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_suggested_allergens'>suggested_allergens</span>
      <span class='ivar'>@suggested_allergens</span> <span class='op'>=</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_suggested_allergens'>suggested_allergens</span>  
    <span class='kw'>end</span> 
    <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span><span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
      <span class='comment'># return so that it doesn&#39;t read next respond_to or format.html
</span>      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_js'>js</span> <span class='lbrace'>{</span><span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit_allergens</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='kw'>return</span><span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span><span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>edit_allergens_page</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='comment'># but if there are no other ingredients to tag
</span>  <span class='kw'>else</span>
    <span class='comment'>#if a JS requiest then go to patient groups
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>recipe_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span><span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
        <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_js'>js</span> <span class='lbrace'>{</span><span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_patient_groups_path'>edit_patient_groups_path</span><span class='lparen'>(</span><span class='ivar'>@recipe</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='kw'>return</span><span class='rbrace'>}</span>
        <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span><span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_patient_groups_path'>edit_patient_groups_path</span><span class='lparen'>(</span><span class='ivar'>@recipe</span><span class='rparen'>)</span> <span class='kw'>and</span> <span class='kw'>return</span><span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='comment'># if html then it was from navbar (for now) and should go to edit page of ingredient
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
        <span class='comment'># if there is an ingredient specified 
</span>        <span class='ivar'>@ingredient</span> <span class='op'>=</span> <span class='const'>Ingredient</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='ivar'>@ingredient</span> <span class='op'>=</span> <span class='ivar'>@recipe</span><span class='period'>.</span><span class='id identifier rubyid_ingredients_tagged'>ingredients_tagged</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_suggested_allergens'>suggested_allergens</span>
        <span class='ivar'>@suggested_allergens</span> <span class='op'>=</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_suggested_allergens'>suggested_allergens</span>  
      <span class='kw'>end</span> 
      <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span><span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
        <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredients/edit_allergens_page</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:locals</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:ingredient</span> <span class='op'>=&gt;</span> <span class='ivar'>@ingredient</span><span class='rbrace'>}</span><span class='rbrace'>}</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="index-instance_method">
  
    - (<tt>Object</tt>) <strong>index</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p># GET /ingredients # GET /ingredients.json</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


6
7
8
9
10
11
12</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/ingredients_controller.rb', line 6</span>

<span class='kw'>def</span> <span class='id identifier rubyid_index'>index</span>
  <span class='ivar'>@ingredients</span> <span class='op'>=</span> <span class='const'>Ingredient</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbrace'>}</span>
  <span class='ivar'>@allergens</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbrace'>}</span>
  <span class='ivar'>@health_groups</span> <span class='op'>=</span> <span class='const'>PatientGroup</span><span class='period'>.</span><span class='id identifier rubyid_all'>all</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbrace'>}</span>
  <span class='ivar'>@top_allergens</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>top_allergen:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbrace'>}</span>
  <span class='ivar'>@common_allergens</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>common_allergen:</span> <span class='kw'>true</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_sort_by'>sort_by</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_a'>a</span><span class='op'>|</span> <span class='id identifier rubyid_a'>a</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_downcase'>downcase</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update-instance_method">
  
    - (<tt>Object</tt>) <strong>update</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>PATCH/PUT /ingredients/1 PATCH/PUT /ingredients/1.json</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


158
159
160
161
162
163
164
165
166
167
168
169
170
171
172</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/ingredients_controller.rb', line 158</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update'>update</span>
  <span class='comment'># recipe ID passed 
</span>  <span class='ivar'>@recipe_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_ingredient_params'>ingredient_params</span><span class='rparen'>)</span>
     <span class='comment'># redirect to list of recipe ingredients and allergens
</span>      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_allergens_ingredients_path'>allergens_ingredients_path</span><span class='lparen'>(</span><span class='label'>recipe_id:</span> <span class='ivar'>@recipe_id</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>notice:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Ingredient was successfully updated.</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:show</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbol'>:ok</span><span class='comma'>,</span> <span class='label'>location:</span> <span class='ivar'>@ingredient</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_js'>js</span> 
    <span class='kw'>else</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:edit</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbol'>:unprocessable_entity</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="update_allergens-instance_method">
  
    - (<tt>Object</tt>) <strong>update_allergens</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'app/controllers/ingredients_controller.rb', line 103</span>

<span class='kw'>def</span> <span class='id identifier rubyid_update_allergens'>update_allergens</span>
  <span class='ivar'>@ingredient</span> <span class='op'>=</span> <span class='const'>Ingredient</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient_id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>allergen_ids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>allergen_ids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_reject!'>reject!</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='rbrace'>}</span>
  <span class='comment'># if ingredient is not tagged as its own allergen then tag it
</span>  <span class='kw'>if</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_allergens'>allergens</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>!=</span> <span class='int'>1</span>
    <span class='comment'># if it is a common allergen mark it
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>common_allergen</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_common_allergen'>common_allergen</span> <span class='op'>=</span> <span class='kw'>true</span> 
      <span class='ivar'>@allergen</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='label'>common_allergen:</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='ivar'>@allergen</span><span class='period'>.</span><span class='id identifier rubyid_common_allergen'>common_allergen</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>common_allergen</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='ivar'>@allergen</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span> 
    <span class='kw'>end</span>  
    <span class='ivar'>@allergen</span><span class='period'>.</span><span class='id identifier rubyid_save!'>save!</span>
    <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>allergen_ids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='ivar'>@allergen</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='comment'># else add self-allergen to allergen array for update of new selects
</span>    <span class='ivar'>@allergen</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>allergen_ids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='ivar'>@allergen</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='comment'># if user added extra allergens to the list
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extra_allergens</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>extra_allergens</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_allergen_name'>allergen_name</span><span class='op'>|</span>
      <span class='id identifier rubyid_added_allergen'>added_allergen</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_where'>where</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='id identifier rubyid_allergen_name'>allergen_name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> 
      <span class='comment'># if it is new then create it 
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_added_allergen'>added_allergen</span> <span class='op'>==</span> <span class='kw'>nil</span>
        <span class='id identifier rubyid_added_allergen'>added_allergen</span> <span class='op'>=</span> <span class='const'>Allergen</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='label'>name:</span> <span class='id identifier rubyid_allergen_name'>allergen_name</span><span class='comma'>,</span> <span class='label'>manual_enter:</span> <span class='kw'>true</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='comment'># add it to the allergen_id params
</span>      <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ingredient</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>allergen_ids</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span><span class='lparen'>(</span><span class='id identifier rubyid_added_allergen'>added_allergen</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_respond_to'>respond_to</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_format'>format</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_ingredient_params'>ingredient_params</span><span class='rparen'>)</span>
      <span class='ivar'>@recipe_id</span> <span class='op'>=</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>id</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
      <span class='ivar'>@recipe</span> <span class='op'>=</span> <span class='const'>Recipe</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='ivar'>@recipe_id</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='ivar'>@recipe</span><span class='period'>.</span><span class='id identifier rubyid_ingredients_not_tagged'>ingredients_not_tagged</span><span class='period'>.</span><span class='id identifier rubyid_count'>count</span> <span class='op'>&gt;=</span> <span class='int'>1</span>
        <span class='comment'># set tagging_done to false
</span>        <span class='ivar'>@tagging_done</span> <span class='op'>=</span> <span class='kw'>false</span>
      <span class='kw'>else</span>
        <span class='ivar'>@tagging_done</span> <span class='op'>=</span> <span class='kw'>true</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_js'>js</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>update_allergens</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>and</span> <span class='kw'>return</span><span class='rbrace'>}</span>
     <span class='comment'># redirect to list of recipe ingredients and allergens
</span>      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_redirect_to'>redirect_to</span> <span class='id identifier rubyid_edit_allergens_path'>edit_allergens_path</span><span class='lparen'>(</span><span class='label'>recipe_id:</span> <span class='ivar'>@recipe_id</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='label'>notice:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Ingredient was successfully updated.</span><span class='tstring_end'>&#39;</span></span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:show</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbol'>:ok</span><span class='comma'>,</span> <span class='label'>location:</span> <span class='ivar'>@ingredient</span> <span class='rbrace'>}</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='symbol'>:edit</span> <span class='rbrace'>}</span>
      <span class='id identifier rubyid_format'>format</span><span class='period'>.</span><span class='id identifier rubyid_json'>json</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_render'>render</span> <span class='label'>json:</span> <span class='ivar'>@ingredient</span><span class='period'>.</span><span class='id identifier rubyid_errors'>errors</span><span class='comma'>,</span> <span class='label'>status:</span> <span class='symbol'>:unprocessable_entity</span> <span class='rbrace'>}</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Jul  7 11:48:44 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.1.5).
</div>

  </body>
</html>